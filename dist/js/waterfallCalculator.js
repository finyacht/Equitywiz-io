let DEFAULT_SHARE_CLASSES=[{id:1,name:"Series A",type:"preferred",seniority:1,liquidationPref:1,prefType:"participating",cap:null},{id:2,name:"Series B",type:"preferred",seniority:2,liquidationPref:1.5,prefType:"participating",cap:3},{id:3,name:"Common",type:"common",seniority:3,liquidationPref:1,prefType:"non-participating",cap:null}],DEFAULT_TRANSACTIONS=[{id:1,shareClass:"Series A",shares:1e6,investment:1e6},{id:2,shareClass:"Series B",shares:2e6,investment:2e6},{id:3,shareClass:"Common",shares:75e4,investment:0}];function calculateDetailedWaterfall(i,t,e){var s=[];let n=e;if(s.push({name:"Total Exit Proceeds",value:e,remainingProceeds:n,isStarting:!0}),0!==t.length){e=i.filter(a=>t.some(e=>e.shareClass===a.name));let a=t.reduce((e,a)=>e+(parseFloat(a.shares)||0),0),r={};t.forEach(e=>{r[e.shareClass]||(r[e.shareClass]=0),r[e.shareClass]+=(parseFloat(e.shares)||0)/a});for(let a of[...e].filter(e=>"preferred"===e.type).sort((e,a)=>e.seniority-a.seniority)){if(n<=0)break;var o=t.filter(e=>e.shareClass===a.name).reduce((e,a)=>e+parseFloat(a.investment||0),0)*parseFloat(a.liquidationPref||1),o=Math.min(o,n);0<o&&(s.push({name:a.name+" (Liquidation Preference)",value:-o,description:a.name+" receives liquidation preference of $"+o.toLocaleString(),remainingProceeds:n,shareClass:a.name}),n-=o)}if(0<n){var l,c,m,i=[...e].sort((e,a)=>e.seniority-a.seniority);let r=0;for(let a of i)"preferred"===a.type&&"participating"!==a.prefType||(l=t.filter(e=>e.shareClass===a.name).reduce((e,a)=>e+parseFloat(a.shares||0),0),r+=l);for(let a of i){if(n<=0)break;if("preferred"!==a.type||"participating"===a.prefType){let e=t.filter(e=>e.shareClass===a.name).reduce((e,a)=>e+parseFloat(a.shares||0),0)/r*n;"preferred"===a.type&&a.cap&&(m=t.filter(e=>e.shareClass===a.name).reduce((e,a)=>e+parseFloat(a.investment||0),0)*a.cap,c=s.filter(e=>e.shareClass===a.name).reduce((e,a)=>e-a.value,0),e=Math.min(e,m-c)),0<(e=Math.min(e,n))&&(m="common"===a.type?"Common Distribution":"Participation",s.push({name:a.name+` (${m})`,value:-e,description:`${a.name} receives ${m.toLowerCase()} of $`+e.toLocaleString(),remainingProceeds:n,shareClass:a.name}),n-=e)}}}if(.01<n){i=e.filter(e=>"common"===e.type);if(0<i.length){let e=0;var u,p,f={};for(let a of i){var d=t.filter(e=>e.shareClass===a.name).reduce((e,a)=>e+parseFloat(a.shares||0),0);e+=d,f[a.name]=d}for(u of i)0<e&&0<(p=f[u.name]/e*n)&&(s.push({name:u.name+" (Additional Distribution)",value:-p,description:u.name+" receives additional distribution of $"+p.toLocaleString(),remainingProceeds:n,shareClass:u.name}),n-=p)}else s.push({name:"Retained by Company",value:-n,description:`$${n.toLocaleString()} remains with the company`,remainingProceeds:n,isRetained:!0})}}return s}function calculateSummaryWaterfall(e,a,r){e=calculateDetailedWaterfall(e,a,r);let i={};return e.slice(1).forEach(e=>{var a;e.isRetained?i["Retained by Company"]={name:"Retained by Company",payout:Math.abs(e.value),components:{Retained:Math.abs(e.value)}}:e.shareClass&&(i[e.shareClass]||(i[e.shareClass]={name:e.shareClass,payout:0,components:{"Liquidation Preference":0,Participation:0,"Common Distribution":0,"Additional Distribution":0}}),a=Math.abs(e.value),i[e.shareClass].payout+=a,e.name.includes("Liquidation Preference")?i[e.shareClass].components["Liquidation Preference"]+=a:e.name.includes("Participation")?i[e.shareClass].components.Participation+=a:e.name.includes("Common Distribution")?i[e.shareClass].components["Common Distribution"]+=a:e.name.includes("Additional Distribution")&&(i[e.shareClass].components["Additional Distribution"]+=a))}),Object.values(i).map(e=>({...e,percentage:Math.round(e.payout/r*1e4)/100}))}function calculateExitDistribution(a,r,i,t=20){var s=[],n=[];for(let e=0;e<=t;e++){var o=i*e/t,o=(s.push(o),calculateSummaryWaterfall(a,r,o));n.push(o)}return{exitValues:s,distributions:n}}function formatCurrency(e){return"$"+e.toLocaleString()}function getShareClassColor(e,a,r=1){return{Common:`rgba(168, 85, 247, ${r})`,"Series A":`rgba(59, 130, 246, ${r})`,"Series B":`rgba(16, 185, 129, ${r})`,"Series C":`rgba(245, 158, 11, ${r})`,"Series D":`rgba(239, 68, 68, ${r})`,"Retained by Company":`rgba(107, 114, 128, ${r})`}[e]||`hsla(${137.5*a}, 70%, 50%, ${r})`}window.waterfallCalculator={calculateDetailedWaterfall:calculateDetailedWaterfall,calculateSummaryWaterfall:calculateSummaryWaterfall,calculateExitDistribution:calculateExitDistribution,formatCurrency:formatCurrency,getShareClassColor:getShareClassColor,DEFAULT_SHARE_CLASSES:DEFAULT_SHARE_CLASSES,DEFAULT_TRANSACTIONS:DEFAULT_TRANSACTIONS};