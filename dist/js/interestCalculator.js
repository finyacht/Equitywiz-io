document.addEventListener("DOMContentLoaded",function(){let d=document.getElementById("interest-type-toggle"),e=document.getElementById("compound-frequency-group"),c=document.getElementById("compound-frequency"),u=document.getElementById("initial-investment"),m=document.getElementById("interest-rate"),t=document.getElementById("interest-rate-slider"),y=document.getElementById("time-period"),i=document.getElementById("time-period-slider"),p=document.getElementById("regular-deposit-toggle"),a=document.getElementById("regular-deposit-options"),h=document.getElementById("deposit-amount"),v=document.getElementById("deposit-frequency"),r=document.querySelectorAll(".time-unit-btn"),s=document.querySelector(".time-unit-toggle"),n=document.getElementById("deposits-card"),f=document.getElementById("summary-initial"),g=document.getElementById("summary-final"),E=document.getElementById("summary-interest"),I=document.getElementById("summary-deposits"),b=document.getElementById("results-table-body"),k=null,B="years",l=null;function x(e){e?n.classList.remove("hidden"):n.classList.add("hidden")}function o(e,t){var a=e.nextElementSibling,t=(a.textContent=t,(e.value-e.min)/(e.max-e.min));a.style.left=10+t*(e.offsetWidth-20)+"px",a.style.visibility="visible",a.style.opacity="1"}function C(){clearTimeout(l),l=setTimeout(D,150)}function D(){var i=parseFloat(u.value),e=parseFloat(m.value)/100;let t=parseInt(y.value);"months"===B?t/=12:"days"===B&&(t/=365);var r=d.checked,a=c.value,l=p.checked,n=l?parseFloat(h.value):0,s=l?v.value:null;if(x(l),isNaN(i)||isNaN(e)||isNaN(t))console.warn("Invalid input values");else{i=((e,n,t,l,a,i,r,s)=>{let o=[],d=e,c=0,u=0,m=1;if(l)switch(a){case"daily":m=365;break;case"monthly":m=12;break;case"quarterly":m=4;break;case"yearly":m=1}let y=0;if(i)switch(s){case"monthly":y=12;break;case"quarterly":y=4;break;case"yearly":y=1}var a=Math.floor(t),p=t-a,h=a+(0<p?1:0);for(let e=1;e<=h;e++){var v,f=e===h&&0<p,g=f?p:1,E=d;let t=0,a=0;if(l)if(i){var I=f?Math.ceil(y*g):y;for(let e=0;e<I;e++){d+=r,t+=r;var b=f&&e===I-1?m/y*(g-e/y):m/y;for(let e=0;e<b;e++){var k=d*(n/m);d+=k,a+=k}}}else{var B=f?Math.ceil(m*g):m;for(let e=0;e<B;e++){var x=d*(n/m);d+=x,a+=x}}else a=E*n*g,d+=a,i&&(v=f?Math.ceil(y*g):y,t=r*v,d+=t);c+=t,u+=a,o.push({year:e,startBalance:E,yearlyDeposit:t,yearlyInterest:a,endBalance:d,cumulativeInterest:u,cumulativeDeposits:c,isPartialYear:f})}return{yearlyData:o,initialInvestment:e,finalBalance:d,totalInterest:u,totalDeposits:c}})(i,e,t,r,a,l,n,s);e=i,f.textContent=L(e.initialInvestment),g.textContent=L(e.finalBalance),E.textContent=L(e.totalInterest),I.textContent=L(e.totalDeposits);{var o=i;let e=document.getElementById("growth-chart").getContext("2d"),t=p.checked,a=o.yearlyData.map(e=>e.isPartialYear?`Year ${Math.floor(e.year-1)+1}*`:"Year "+e.year),n=o.yearlyData.map(e=>e.endBalance),l=(o.initialInvestment,o.yearlyData.map(e=>e.cumulativeDeposits),o.yearlyData.map(e=>e.cumulativeInterest),o.yearlyData.map(e=>o.initialInvestment+e.cumulativeDeposits));k&&k.destroy();r=[{label:"Initial Investment",data:l.map(()=>o.initialInvestment),backgroundColor:"rgba(99, 102, 241, 0.8)",stack:"stack0",borderWidth:0},{label:"Interest",data:o.yearlyData.map(e=>e.cumulativeInterest),backgroundColor:"rgba(34, 197, 94, 0.8)",stack:"stack0",borderWidth:0}];t&&r.splice(1,0,{label:"Deposits",data:o.yearlyData.map(e=>e.cumulativeDeposits),backgroundColor:"rgba(236, 72, 153, 0.8)",stack:"stack0",borderWidth:0}),k=new Chart(e,{type:"bar",data:{labels:a,datasets:r},options:{responsive:!0,maintainAspectRatio:!1,animation:{duration:500},plugins:{tooltip:{callbacks:{label:function(e){return e.dataset.label+": "+L(e.raw)},footer:function(e){e=e[0].dataIndex;return"Total: "+L(n[e])}}},legend:{position:"bottom"},title:{display:!0,text:"Investment Growth Over Time",font:{size:16}}},scales:{x:{stacked:!0,grid:{display:!1}},y:{stacked:!0,beginAtZero:!0,ticks:{callback:function(e){return L(e,!1)}}}}}})}{a=i;b.innerHTML="";let n=p.checked,e=document.querySelector(".results-table thead tr"),t=e.querySelector("th:nth-child(3)");t&&(t.style.display=n?"table-cell":"none"),a.yearlyData.forEach(e=>{var t=document.createElement("tr"),a=document.createElement("td"),a=(a.textContent=e.isPartialYear?`Year ${Math.floor(e.year-1)+1}*`:"Year "+e.year,t.appendChild(a),document.createElement("td")),a=(a.textContent=L(e.startBalance),t.appendChild(a),document.createElement("td")),a=(a.textContent=L(e.yearlyDeposit),a.style.display=n?"table-cell":"none",t.appendChild(a),document.createElement("td")),a=(a.textContent=L(e.yearlyInterest),t.appendChild(a),document.createElement("td"));a.textContent=L(e.endBalance),t.appendChild(a),b.appendChild(t)}),a.yearlyData.some(e=>e.isPartialYear)&&((a=document.createElement("tr")).classList.add("footnote-row"),(l=document.createElement("td")).colSpan=5,l.style.fontSize="12px",l.style.fontStyle="italic",l.style.color="var(--gray-600)",l.textContent="* Partial year calculation",a.appendChild(l),b.appendChild(a))}}}function L(e,t=!0){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:t?2:0,maximumFractionDigits:t?2:0}).format(e)}d.addEventListener("change",function(){e.style.display=this.checked?"block":"none",D()}),p.addEventListener("change",function(){a.style.display=this.checked?"block":"none",x(this.checked),D()}),x(p.checked),r.forEach(e=>{e.addEventListener("click",function(){r.forEach(e=>e.classList.remove("active")),this.classList.add("active");var n=this.dataset.unit;{var l=B;B=n,s.dataset.active=n;let e=parseInt(y.value),t,a;a="years"===l&&"months"===n?(t=12*e,120):"years"===l&&"days"===n?(t=365*e,3650):"months"===l&&"years"===n?(t=Math.max(1,Math.round(e/12)),50):"months"===l&&"days"===n?(t=30*e,3650):"days"===l&&"years"===n?(t=Math.max(1,Math.round(e/365)),50):"days"===l&&"months"===n?(t=Math.max(1,Math.round(e/30)),120):(t=e,"years"===n?50:"months"===n?120:3650),y.value=t,y.max=a,i.value=t,i.max=a,i.step="years"===n||"months"===n?1:5,y.step=1,D()}})}),t.addEventListener("input",function(){m.value=this.value,o(this,this.value+"%"),C()}),m.addEventListener("input",function(){t.value=this.value,C()}),i.addEventListener("input",function(){y.value=this.value,o(this,this.value+" "+B),C()}),y.addEventListener("input",function(){i.value=this.value,C()}),[u,h,v,c].forEach(e=>{e.addEventListener("input",C),e.addEventListener("change",D)}),D()});